!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.doggodb=t():e.doggodb=t()}(window,(function(){return function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){let a=window.localStorage,i=JSON.parse,n=JSON.stringify,s="No Databse Name provided.",r="No Table Name provided.",o="No Data provided.",l="No reference to table created.",c="Table with that name already exists.",b="Not a valid object for storage.",h={entryId:!0},d={$not:"not",$in:"in",$notIn:"not-in",$includes:"includes",$notIncludes:"not-includes"},u={$or:"or"};class f{constructor(e){if(!e)throw new Error("No table name provided.");this.contents=[],this.tableName=e,this.createdAt=new Date,this.updatedAt=new Date}}function v(e,t,a,i){if(!e||"object"!=typeof e)throw new Error("Invalid row type.");if(!e[t])return!1;switch(a){case"in":if(!i||!Array.isArray(i))throw new Error("value to check field value 'in' is not an iterable.");return i.includes(e[t]);case"not-in":if(!i||!Array.isArray(i))throw new Error("value to check field value 'not-in' is not an iterable.");return!i.includes(e[t]);case"not":return e[t]!=i;case"includes":return e[t].includes(i);case"not-includes":return!e[t].includes(i);default:throw new Error("Invalid/Unsupported operation.")}}function p(e,t){let a=!1;for(let i in t)if(i in e&&e[i]==t[i]){a=!0;break}return a}e.exports={db:class{constructor(e,t={onChange:null}){if(!e)throw new Error(s);let r=function(e){return a.getItem(e)}(e),o={tables:{},createdAt:new Date,updatedAt:new Date};r&&(o=i(r)),o||function(e){if(a.getItem(e))throw new Error("Database with that name already exists.");a.setItem(e,n({tables:{},createdAt:new Date,updatedAt:new Date}))}(e),this.database=o,this.activeTable=null,this.databaseName=e,this.onChange=null,t&&"object"==typeof t&&(this.onChange=t.onChange||null)}save(){var e,t;e=this.databaseName,t=this.database,a.setItem(e,n(t)),this.database.updatedAt=new Date,this.onChange&&"function"==typeof this.onChange&&this.onChange(this.database)}table(e){if(!e)throw new Error(r);return this.database.tables[e]?this.activeTable=this.database.tables[e]:this.create(e),this}list(){return this.database.tables}create(e){if(!e)throw new Error(r);if(e in this.database.tables)throw new Error(c);return this.activeTable=new f(e),this.database.tables[e]=this.activeTable,this.save(),this}drop(e){if(e)this.activeTable&&e===this.activeTable.tableName&&(this.activeTable=null),e in this.database.tables&&delete this.database.tables[e];else{let e=null;this.activeTable&&(e=this.activeTable.tableName,this.activeTable=null),e in this.database.tables&&delete this.database.tables[e]}return this.save(),this}get(){if(this.activeTable)return this.activeTable.contents;throw new Error(l)}add(e){if(!e)throw new Error(o);if(!this.activeTable)throw new Error(l);if("object"!=typeof e||!Object.keys(e).length)throw new Error(b);return this.activeTable.contents.push({...e,entryId:parseInt((new Date).getTime()+10*Math.random()+10*Math.random())}),this.activeTable.updatedAt=new Date,this.database.tables[this.activeTable.tableName]=this.activeTable,this.save(),this}find(e,t={offset:0,limit:null}){try{let{limit:a,offset:i}=t;if(a||(a=1/0),i||(i=0),this.activeTable&&this.activeTable.contents&&this.activeTable.contents.length&&e&&Object.keys(e).length){let t=[],n=0;for(let s of this.activeTable.contents){if(n>=i&&t.length<=a){let a=!0;for(let t in e)t in u&&"object"==typeof e[t]?p(s,e[t])||(a=!1):t in d&&"object"==typeof e[t]?v(s,Object.keys(e[t])[0],d[t],Object.values(e[t])[0])||(a=!1):t in s&&s[t]==e[t]||(a=!1);a&&t.push(s)}n++}return t}return this.activeTable&&this.activeTable.contents?i||a!==1/0?[...this.activeTable.contents].slice(i,i+a):this.activeTable.contents:[]}catch(e){throw new Error(e.message)}}findAndUpdate(e,t,a=!0){if(this.activeTable&&this.activeTable.contents&&this.activeTable.contents.length&&t){if(t&&Object.keys(t).length>0)for(let e in t)e in h&&delete t[e];for(let i=0;i<this.activeTable.contents.length;i++){let n=!0,s=this.activeTable.contents[i];if(e&&Object.keys(e).length>0)for(let t in e)t in u&&"object"==typeof e[t]?p(s,e[t])||(n=!1):t in d&&"object"==typeof e[t]?v(s,Object.keys(e[t])[0],d[t],Object.values(e[t])[0])||(n=!1):t in s&&s[t]==e[t]||(n=!1);if(n&&(s={...s,...t},this.activeTable.contents[i]=s),a)break}this.database.tables[this.activeTable.tableName]=this.activeTable,this.save()}return this}updateAt(e,t){if(!this.activeTable)throw new Error(erors.NOACTIVETABLE);if(this.activeTable&&this.activeTable.contents&&this.activeTable.contents.length&&e>=0&&this.activeTable.contents.length>e&&t){if(t&&Object.keys(t).length>0)for(let e in t)e in h&&delete t[e];this.activeTable.contents[e]={...this.activeTable.contents[e],...t},this.activeTable.updatedAt=new Date,this.database.tables[this.activeTable.tableName]=this.activeTable,this.save()}return this}delete(e,t=!0){if(this.activeTable&&this.activeTable.contents&&this.activeTable.contents.length&&e&&updates){for(let a=0;a<this.activeTable.contents.length;a++){let i=!0,n=this.activeTable.contents[a];for(let t in e)t in u&&"object"==typeof e[t]?p(n,e[t])||(i=!1):t in d&&"object"==typeof e[t]?v(n,Object.keys(e[t])[0],d[t],Object.values(e[t])[0])||(i=!1):t in n&&n[t]==e[t]||(i=!1);if(i&&this.activeTable.contents.splice(a,1),t)break}this.database.tables[this.activeTable.tableName]=this.activeTable,this.save()}return this}}}}])}));